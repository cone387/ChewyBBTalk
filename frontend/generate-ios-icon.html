<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>iOS 图标生成器</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      margin-bottom: 10px;
    }
    .description {
      color: #666;
      margin-bottom: 30px;
      line-height: 1.6;
    }
    .input-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-bottom: 8px;
      color: #333;
      font-weight: 500;
    }
    input[type="file"] {
      display: block;
      margin-bottom: 10px;
    }
    input[type="color"] {
      width: 100px;
      height: 40px;
      border: 1px solid #ddd;
      border-radius: 4px;
      cursor: pointer;
    }
    input[type="range"] {
      width: 100%;
    }
    .preview {
      margin: 30px 0;
      text-align: center;
    }
    canvas {
      border: 1px solid #ddd;
      border-radius: 8px;
      max-width: 100%;
    }
    button {
      background: #007AFF;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      margin-right: 10px;
    }
    button:hover {
      background: #0051D5;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .info {
      background: #e3f2fd;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      color: #1976d2;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>iOS PWA 图标生成器</h1>
    <p class="description">
      上传你的图标（建议 SVG 或高分辨率 PNG），添加背景色，生成适合 iOS 的 apple-touch-icon。
      iOS 会自动给图标添加圆角，所以我们需要确保图标填满整个画布。
    </p>

    <div class="input-group">
      <label>1. 选择图标文件</label>
      <input type="file" id="iconFile" accept="image/*">
    </div>

    <div class="input-group">
      <label>2. 选择背景色</label>
      <input type="color" id="bgColor" value="#4F46E5">
      <small style="color: #666; margin-left: 10px;">建议使用品牌主色</small>
    </div>

    <div class="input-group">
      <label>3. 图标缩放 (<span id="scaleValue">80</span>%)</label>
      <input type="range" id="iconScale" min="50" max="100" value="80">
      <small style="color: #666;">调整图标在背景中的大小，留出适当边距</small>
    </div>

    <div class="preview">
      <h3>预览 (180x180)</h3>
      <canvas id="preview" width="180" height="180"></canvas>
    </div>

    <div>
      <button id="downloadBtn" disabled>下载 apple-touch-icon.png</button>
      <button id="download192Btn" disabled>下载 pwa-192x192.png</button>
      <button id="download512Btn" disabled>下载 pwa-512x512.png</button>
    </div>

    <div class="info">
      <strong>使用说明：</strong><br>
      1. 生成的图标会自动填充背景色，避免 iOS 上的空白边距<br>
      2. 下载后替换 frontend/public/ 目录下的对应文件<br>
      3. 重新构建并部署应用<br>
      4. 在 iOS 上删除旧的 PWA 图标，重新添加到主屏幕
    </div>
  </div>

  <script>
    const iconFile = document.getElementById('iconFile');
    const bgColor = document.getElementById('bgColor');
    const iconScale = document.getElementById('iconScale');
    const scaleValue = document.getElementById('scaleValue');
    const preview = document.getElementById('preview');
    const ctx = preview.getContext('2d');
    const downloadBtn = document.getElementById('downloadBtn');
    const download192Btn = document.getElementById('download192Btn');
    const download512Btn = document.getElementById('download512Btn');

    let currentImage = null;

    iconScale.addEventListener('input', (e) => {
      scaleValue.textContent = e.target.value;
      if (currentImage) drawIcon();
    });

    bgColor.addEventListener('input', () => {
      if (currentImage) drawIcon();
    });

    iconFile.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = (event) => {
        const img = new Image();
        img.onload = () => {
          currentImage = img;
          drawIcon();
          downloadBtn.disabled = false;
          download192Btn.disabled = false;
          download512Btn.disabled = false;
        };
        img.src = event.target.result;
      };
      reader.readAsDataURL(file);
    });

    function drawIcon() {
      const scale = iconScale.value / 100;
      
      // 填充背景
      ctx.fillStyle = bgColor.value;
      ctx.fillRect(0, 0, 180, 180);

      // 计算图标尺寸和位置（居中）
      const iconSize = 180 * scale;
      const x = (180 - iconSize) / 2;
      const y = (180 - iconSize) / 2;

      // 绘制图标
      ctx.drawImage(currentImage, x, y, iconSize, iconSize);
    }

    function generateIcon(size) {
      const canvas = document.createElement('canvas');
      canvas.width = size;
      canvas.height = size;
      const ctx = canvas.getContext('2d');

      const scale = iconScale.value / 100;

      // 填充背景
      ctx.fillStyle = bgColor.value;
      ctx.fillRect(0, 0, size, size);

      // 计算图标尺寸和位置
      const iconSize = size * scale;
      const x = (size - iconSize) / 2;
      const y = (size - iconSize) / 2;

      // 绘制图标
      ctx.drawImage(currentImage, x, y, iconSize, iconSize);

      return canvas;
    }

    downloadBtn.addEventListener('click', () => {
      const canvas = generateIcon(180);
      const link = document.createElement('a');
      link.download = 'apple-touch-icon.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
    });

    download192Btn.addEventListener('click', () => {
      const canvas = generateIcon(192);
      const link = document.createElement('a');
      link.download = 'pwa-192x192.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
    });

    download512Btn.addEventListener('click', () => {
      const canvas = generateIcon(512);
      const link = document.createElement('a');
      link.download = 'pwa-512x512.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
    });
  </script>
</body>
</html>
