# 生产环境 Docker Compose
# 两服务架构：前端Nginx + 后端
# - 前端Nginx: 统一入口，暴露4010端口，代理静态文件和后端API
# - 后端: 内部8020端口

services:
  # ============================================
  # 后端服务
  # ============================================
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: chewybbtalk-backend
    env_file: .env
    expose:
      - "8020"
    volumes:
      - ${DATA_DIR:-./data}:/app/data
    restart: unless-stopped
    networks:
      - bbtalk-network

  # ============================================
  # 前端服务（包含Nginx代理）
  # ============================================
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: chewybbtalk-frontend
    ports:
      - "4010:4010"
    volumes:
      - ${DATA_DIR:-./data}/media:/app/data/media:ro
      - ${DATA_DIR:-./data}/staticfiles:/app/data/staticfiles:ro
    depends_on:
      - backend
    restart: unless-stopped
    networks:
      - bbtalk-network

networks:
  bbtalk-network:
    driver: bridge
